<app-content-header [title]="'Roles'"></app-content-header>
<section class="content">
    <div class="container-fluid">
        <div class="row">
            <div class="col-sm-12">
                <div class="card">
                    <div class="card-header">
                        <div class="row">
                            <div class="col">
                                <h6>
                                    <i class="fas fa-user-md"></i>
                                    Roles
                                </h6>
                            </div>
                            <div class="col text-right">
                                <button class="btn btn-primary btn-sm" (click)="openModal(content, null)">
                                    <i class="fas fa-plus"></i> Add Role
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="card-body">
                        <table class="table">
                            <thead>
                                <th>ID</th>
                                <th>Name</th>
                                <th>Can Register</th>
                                <th>Date</th>
                                <th class="text-right">Action</th>
                            </thead>
                            <tbody>
                                <tr *ngIf="isLoading">
                                    <td colspan="5" class="text-center">
                                        <div class="alert alert-secondary">
                                            <div class="spinner-border spinner-border-sm" role="status"
                                                *ngIf="isLoading">
                                                <span class="sr-only">Loading...</span>
                                            </div>
                                            Loading Roles...
                                        </div>
                                    </td>
                                </tr>
                                <tr *ngIf="!isLoading && roles.length == 0">
                                    <td colspan="5" class="text-center">
                                        <div class="alert alert-secondary">
                                            <i class="fas fa-ban"></i> No
                                            <b>Roles Found!</b>
                                        </div>
                                    </td>
                                </tr>
                                <tr *ngFor="
                                        let role of roles;
                                        let i = index
                                    ">
                                    <td>{{ i + 1 }}</td>
                                    <td>{{ role.name }}</td>
                                    <td><span class="badge badge-primary btn-pill"
                                            *ngIf="role.can_self_register">Yes</span><span
                                            class="badge badge-secondary btn-pill"
                                            *ngIf="!role.can_self_register">No</span></td>
                                    <td>
                                        {{ formatDate(role.created_at) }}
                                    </td>
                                    <!--<td>
                    <span class="badge badge-primary btn-pill" *ngIf="user.status">Active</span>
                    <span class="badge badge-secondary btn-pill" *ngIf="!user.status">In-Active</span>
                  </td>-->
                                    <td class="text-right">
                                        <a class="btn btn-outline-primary btn-sm"
                                            [routerLink]="['/dashboard/users/roles/view', role.id]">

                                            <i class="fas fa-eye"></i> View
                                        </a>&nbsp;
                                        <button class="btn btn-primary btn-sm" (click)="
                                                openModal(content, role)
                                            ">
                                            <i class="fas fa-edit"></i> Edit
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<ng-template #content let-modal>
    <div class="modal-header">
        <h4 class="modal-title" id="modal-basic-title">{{rolesForm.value.id > 0? 'Edit Role' : 'Add Role'}}</h4>
        <button type="button" class="btn-close close" aria-label="Close" (click)="modal.dismiss('Cross click')">
            <i class="fas fa-times"></i>
        </button>
    </div>
    <div class="modal-body">
        <form [formGroup]="rolesForm" (submit)="addRole()">
            <input type="hidden" formControlName="id" />
            <div class="mb-3">
                <label>Name</label>
                <input class="form-control" placeholder="Name" formControlName="name"
                    [class.is-invalid]="rolesForm.get('name')?.invalid && (rolesForm.get('name')?.touched || rolesForm.get('name')?.dirty)" />
                <div class="invalid-feedback d-block"
                    *ngIf="rolesForm.get('name')?.errors?.['required'] && (rolesForm.get('name')?.touched || rolesForm.get('name')?.dirty)">
                    Name is required
                </div>
            </div>
            <div class="mb-3">
                <label>Can Self Register</label>
                <select class="form-control custom-select" formControlName="can_self_register">
                    <option value="1">YES</option>
                    <option value="0">NO</option>
                </select>
            </div>
        </form>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-outline-secondary" (click)="modal.close('Save click')">
            Close
        </button>
        <button type="button" class="btn btn-primary" [disabled]="isLoading" (click)="addRole()">
            <div class="spinner-border spinner-border-sm" role="status" *ngIf="isLoading">
                <span class="sr-only">Loading...</span>
            </div>
            Save Changes
        </button>
    </div>
</ng-template>