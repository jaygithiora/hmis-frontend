<app-content-header [title]="'Laboratory Tests'"></app-content-header>
<section class="content">
    <div class="container-fluid">
        <div class="row">
            <div class="col-sm-12">
                <div class="card">
                    <div class="card-header">
                        <div class="row">
                            <div class="col">
                                <h6>
                                    <i class="fas fa-vials"></i>
                                    Laboratory Tests
                                </h6>
                            </div>
                        </div>
                    </div>
                    <div class="card-body">
                        <form [formGroup]="publishTestForm" (submit)="addLocation()">
                        <table class="table">
                            <thead>
                                <th><!-- HEADER SELECT ALL CHECKBOX -->
                                    <input type="checkbox" id="selectAll"
                                        formControlName="selectAll" (change)="onSelectAllChange($event)" />
                                </th>
                                <th>Patient Code</th>
                                <th>Visit Code</th>
                                <th>Patient Name</th>
                                <th>Test Name</th>
                                <th>Sample Type</th>
                                <th>Date</th>
                                <th class="text-right">Action</th>
                            </thead>
                            <tbody >
                                <tr *ngIf="isLoading">
                                    <td colspan="9" class="text-center">
                                        <div class="alert alert-secondary">
                                            <div class="spinner-border spinner-border-sm" role="status"
                                                *ngIf="isLoading">
                                                <span class="sr-only">Loading...</span>
                                            </div>
                                            Loading Laboratory Tests...
                                        </div>
                                    </td>
                                </tr>
                                <tr *ngIf="!isLoading && laboratory_test_results.length == 0">
                                    <td colspan="9" class="text-center">
                                        <div class="alert alert-secondary">
                                            <i class="fas fa-ban"></i> No
                                            <b>Laboratory Tests</b> Found!
                                        </div>
                                    </td>
                                </tr>
                                <tr *ngFor="
                                        let ltr of laboratory_test_results;
                                        let i = index
                                    ">
                                    <td>
                                        <div class="form-check">
                                            <input type="checkbox" class="form-check-input" [id]="'ltr-' + ltr.id"
                                                [checked]="isSelected(ltr.id)"
                                                (change)="onCheckboxChange($event, ltr)" />
                                        </div>
                                    </td>
                                    <td>{{ ltr?.bill?.outpatient_visit?.patient?.code }}</td>
                                    <td>{{ ltr?.bill?.outpatient_visit?.code }}</td>
                                    <td>{{ ltr.bill?.outpatient_visit?.patient?.first_name }} {{
                                        ltr.bill?.outpatient_visit?.patient?.other_names }}</td>
                                    <td>{{ ltr.patient_laboratory_test?.laboratory_test_rate?.laboratory_test?.name }}
                                    </td>
                                    <td>{{
                                        ltr.patient_laboratory_test?.laboratory_test_rate?.laboratory_test?.laboratory_sample_type?.name
                                        }}</td>
                                    <td>
                                        {{ formatDate(ltr?.sample_collection?.updated_at) }}
                                    </td>
                                    <td>
                                        <div ngbDropdown container="body">
                                            <button type="button"
                                                class="btn btn-outline-primary btn-sm pr-3 pl-3 border-0"
                                                ngbDropdownToggle>
                                                <i class="fas fa-ellipsis-v"></i>
                                            </button>
                                            <div ngbDropdownMenu>
                                                <a ngbDropdownItem [routerLink]="
                                                        '/dashboard/laboratory/lab-work-list/view/' +
                                                        ltr.bill_id
                                                    ">View <i class="fas fa-long-arrow-alt-right"></i></a>
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        <div class="text-right">
                            <hr />
                            <button type="button" class="btn btn-primary"
                                [disabled]="isLoading||this.selectedItemsArray.length <= 0" (click)="addLocation()">
                                <div class="spinner-border spinner-border-sm" role="status" *ngIf="isLoading">
                                    <span class="sr-only">Loading...</span>
                                </div>
                                <i class="fab fa-airbnb" *ngIf="!isLoading"></i>
                                Publish Results
                            </button>
                        </div></form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>